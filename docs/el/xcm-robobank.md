---
title: Δοκιμαστική σουίτα Substrate Cumulus Parachain για ανταλλαγή μηνυμάτων μεταξύ αλυσίδων 

contributors: [ddulesov, boogerwooger, tubleronchik] 
---


Ο κύριος στόχος αυτού του έργου είναι η απλοποίηση της ανάπτυξης του runtime των parachain, όταν χρησιμοποιούντι μηνύματα μεταξύ αλυσίδων. 
Επιτρέπει την ανάπτυξη κώδικα runtime με ενσωματωμένες δοκιμές με υψηλό βαθμό επαναληψιμότητας και απλή χρήση.
Αυτοματοποιεί την κατασκευή, την κατασκευή προκαθορισμένης διαμόρφωσης δικτύου (δηλαδή 1 αλυσίδα ρελέ + 2 parachains), τη δημιουργία καναλιών μεταξύ των parachains και την εκτέλεση δοκιμών μηνυμάτων, αποστολή μηνυμάτων, χρήση κλήσης στο runtime, όλα κατασκευασμένα και συνταγμένα σε Python.

Το XCM Testsuite χρησιμοποιείται για τη δοκιμή του κύκλου παραγωγής της Robobank - του συνόλου των Substrate pallets, που επιτρέπουν σε ρομπότ να εγγραφούν σε εξωτερικά parachains, να λαμβάνουν προπληρωμένες παραγγελίες, να τις εκτελούν και να λαμβάνουν πληρωμές χρησιμοποιώντας εξωτερικά tokens. Αυτό επιτρέπει στα ρομπότ να λειτουργούν εντός του δικτύου Robonomics με όλη την απαιτούμενη υποδομή, αλλά ταυτόχρονα να προσφέρουν τις υπηρεσίες τους σε οποιοδήποτε άλλο parachain.

Ένα παράδειγμα βίντεο είναι διαθέσιμο στο [YouTube](https://www.youtube.com/watch?v=S_bZgsxngiM)

Οι κύρια βήματα στο σενάριο επίδειξης είναι:
- εκκίνηση αλυσίδας ρελέ και δύο parachains σε ένα πακέτο 6 διεργασιών
- δημιουργία καναλιών μηνυμάτων XCM μεταξύ των parachains
- εγγραφή ενός ρομπότ σε και τα δύο parachains
- δημιουργία μιας παραγγελίας για αυτό το ρομπότ στο client parachain (κράτηση πληρωμής για την ολοκλήρωση της παραγγελίας)
- αποστολή μηνύματος XCM στο Robonomics parachain
- δημιουργία της καταγραφής της παραγγελίας "καθρέφτη" στο Robonomics parachain
- το ρομπότ αποδέχεται την παραγγελία στο Robonomics parachain
- αποστολή μηνύματος XCM για την αποδοχή της παραγγελίας πίσω στο client parachain
- αποδοχή της παραγγελίας στο client parachain (κράτηση ποινής για έλλειψη ολοκλήρωσης της παραγγελίας μέχρι την προθεσμία της παραγγελίας)
- το ρομπότ ολοκληρώνει την παραγγελία στο Robonomics parachain
- αποστολή μηνύματος XCM για την ολοκλήρωση της παραγγελίας στο client parachain
- εξόφληση όλων των πληρωμών (η πληρωμή του πελάτη μεταφέρεται στο ρομπότ, καθώς και η μη αξιοποίητη ποινή)
- κλείσιμο της παραγγελίας1


## Προς τα πάνω
Αυτό το έργο είναι ένα fork του
[Substrate Developer Hub Node Template](https://github.com/substrate-developer-hub/substrate-node-template).
Περιέχει κώδικα των runtime pallets που δοκιμάζονται.
Όπως και στον αρχικό κώδικα των κόμβων, ο κώδικας των parachains βρίσκεται στους καταλόγους "./pallets", "./runtime", "./node".

Διαφορές με το αρχικό "substrate-node-template":
- αυτός ο collator runtime έχει τον HRMP handler module και μπορεί να χειριστεί μηνύματα από αδελφούς parachains
- έτοιμος δοκιμαστικός runtime για εσωτερικές δοκιμές XCM

## Κατασκευή & Εκτέλεση
Συνιστάται (ιδιαίτερα) η εγκατάσταση: 
```
Ubuntu 20, 16 Gb RAM, 8 CPU, 120 Gb SSD
```
[ΣΗΜΕΙΩΣΗ] Η πρώτη δημιουργία μπορεί να πάρει πολύ χρόνο, έως και αρκετές ώρες σε μη βέλτιστες μηχανές.

[ΣΗΜΕΙΩΣΗ] Το σενάριο λειτουργεί με τις ΣΤΑΘΕΡΕΣ εκδόσεις (commit hashes) του Polkadot(Rococo) στην αλυσίδα αναμετάδοσης και των παρααλυσίδων.

[ΣΗΜΕΙΩΣΗ] Από προεπιλογή, το σενάριο δημιουργεί ξανά το ίδιο περιβάλλον κάθε φορά που ξεκινάει, αφαιρώντας όλες τις προηγούμενες καταστάσεις. Αυτή η συμπεριφορά μπορεί να αλλάξει στο "config.sh" χρησιμοποιώντας την παράμετρο "PERSISTENT".


Εκτέλεση δημιουργίας και εγκατάστασης σεναρίου.  
```bash
git clone https://github.com/airalab/xcm-robobank-prototype.git
cd xcm-robobank-prototype
./scripts/init.sh
```

Βασικές ενέργειες του σεναρίου "init.sh":
 - ανάγνωση ρυθμίσεων (αρχείο "config.sh" με αριθμό αναθεώρησης, αρχικά κλειδιά κόμβου και αναγνωριστικά, παράμετρος διατήρησης chaindata κ.λπ.)
 - εγκατάσταση πακέτων λειτουργικού συστήματος, Rust και Python
 - δημιουργία ξεχωριστών δυαδικών αρχείων για την αλυσίδα αναμετάδοσης και για τις δύο παρααλυσίδες
    - τα δυαδικά αρχεία θα δημιουργηθούν στον υποφάκελο ./bin. 
 - (προαιρετικό) αφαίρεση όλων των προηγούμενων δεδομένων αλυσίδας για όλες τις αλυσίδες
    - απενεργοποιείται αν η "PERSISTENT=1" έχει οριστεί στο "config.sh"
 - εκτέλεση ως ξεχωριστές διεργασίες (με ξεχωριστά PIDs και I/O pipes):
    - επαληθευτές της αλυσίδας αναμετάδοσης (δηλαδή 4 επαληθευτές που εκτελούν μια σταθερή αναθεώρηση Rococo)
    - συλλέκτες για την παρααλυσίδα-100 (δηλαδή ένας μόνο συλλέκτης για την πρώτη παρααλυσίδα που αναπτύσσετε)
    - συλλέκτες για την παρααλυσίδα-200 (δηλαδή ένας μόνο συλλέκτης για την δεύτερη παρααλυσίδα που αναπτύσσετε)
 - εκτύπωση όλων των σημείων έναρξης, θυρών στην κονσόλα, επιτρέποντάς σας να μελετήσετε οποιαδήποτε αλυσίδα χρησιμοποιώντας εφαρμογές προσκομιστή (explorer, DApp)
 - συνεχής εκτύπωση όλων των δεδομένων εξόδου όλων των αλυσίδων στην κονσόλα

[ΠΡΟΕΙΔΟΠΟΙΗΣΗ] Μετά την εκκίνηση, περιμένετε μέχρι η δίκτυο να είναι ενεργό, βεβαιωθείτε ότι η ολοκλήρωση των μπλοκ έχει ξεκινήσει και ότι οι παρααλυσίδες έχουν καταχωρηθεί. Αυτές οι διαδικασίες θα πρέπει να απαιτούν περίπου 5 λεπτά (50 μπλοκ x 6 δευτερόλεπτα).

## Έλεγχος ότι η αρχική ρύθμιση λειτουργεί 

Χρησιμοποιήστε το πρότυπο προσκομιστή Polkdot και τα δημιουργημένα σημεία έναρξης "--ws-port" για να συνδεθείτε με κάθε κόμβο.
Ανοίξτε την [εφαρμογή Polkadot](https://polkadot.js.org/apps/?rpc=ws://localhost:9500/) για να παρακολουθήσετε τις αλυσίδες. 

### Παράδειγμα:
Τοπικός υπολογιστής, 4 επαληθευτές αλυσίδας αναμετάδοσης, ένας συλλέκτης παρααλυσίδας-100, ένας συλλέκτης παρααλυσίδας-200:
- [Relay validator 1](https://polkadot.js.org/apps/?rpc=ws://localhost:9500/)
- [Relay validator 2](https://polkadot.js.org/apps/?rpc=ws://localhost:9501/)
- [Relay validator 3](https://polkadot.js.org/apps/?rpc=ws://localhost:9502/)
- [Relay validator 4](https://polkadot.js.org/apps/?rpc=ws://localhost:9503/)
- [Parachain-100 collator](https://polkadot.js.org/apps/?rpc=ws://localhost:10054/)
- [Parachain-200 collator](https://polkadot.js.org/apps/?rpc=ws://localhost:10055/)


Αν όλα λειτουργούν και η συναίνεση ξεκίνησε, μπορούμε να προχωρήσουμε στην εκτέλεση των δοκιμαστικών μας περιπτώσεων (σε ένα νέο τερματικό).

### Δοκιμή μετάδοσης μηνυμάτων UMP
```bash
./scripts/init.sh ump
```
Δημιουργεί ένα μήνυμα `Balance.transfer` στην `παρααλυσίδα-100` και το περνά στην αλυσίδα αναμετάδοσης.
Όταν η αλυσίδα αναμετάδοσης λάβει το μήνυμα, θα μεταφέρει 15 νομίσματα από τον λογαριασμό `para 100` στον λογαριασμό Charlie.


### Δοκιμή πέρασματος μηνυμάτων HRMP
```bash
./scripts/init.sh ump
```

Δημιουργεί ένα μήνυμα `Balance.transfer` στο `parachain-100` και το περνάει στο `sibling 200`.
Πριν από αυτό, εφοδιάζει τον λογαριασμό `subl 100` με 1000 νομίσματα και δημιουρεί ένα κανάλι επικοινωνίας μεταξύ των parachains.
```bash
./scripts/init.sh hrmp
```
Τα επόμενα μηνύματα μπορούν να σταλούν εκτελώντας την υποεντολή `hrmpm`. Δεν δημιουργεί ένα κανάλι και γι' αυτό τρέχει πιο γρήγορα.
```bash
./scripts/init.sh hrmpm
```

### Περισσότερες επιλογές
```bash
./scripts/init.sh help
```

## Τοπικό Testnet

### Δημιουργία προσαρμοσμένου chain spec
```
./bin/polkadot build-spec --chain rococo-local --disable-default-bootnode > rococo_local.json
```

Επεξεργασία του rococo_local.json, αντικατάσταση των παραμέτρων ισορροπιών και αρχών με τις δικές σας.
```json
  "keys": [
    [
      "",
      "",
      {
        "grandpa": "",
        "babe": "",
        "im_online": "",
        "para_validator": "",
        "para_assignment": "",
        "authority_discovery": ""
      }
    ]
```

Διεύθυνση Polkadot για το //Alice//stash (κρυπτογραφία sr25519).
```bash
$ polkadot key inspect-key --scheme sr25519 --network substrate //Alice//stash
```

```text
Secret Key URI `//Alice//stash` is account:
Secret seed:      

Public key (hex): 

Account ID:       

SS58 Address:     
```

Κλειδί συνεδρίας Polkadot grandpa για το //Alice (κρυπτογραφία ed25519).
```bash
$ polkadot key inspect-key --scheme ed25519 --network substrate //Alice
```
```text
Secret Key URI `//Alice` is account:
Secret seed:      

Public key (hex): 

Account ID:       

SS58 Address:     
```

Διεύθυνση Polkadot για το //Alice (κρυπτογραφία sr25519).
```
$ polkadot key inspect-key --scheme sr25519 --network substrate //Alice
```
```text
Secret Key URI `//Alice` is account:
Secret seed:      

Public key (hex): 

Account ID:       

SS58 Address:     
```

Μετατροπή του rococo_local.json σε μορφή raw.
```
./bin/polkadot build-spec --chain rococo_local.json --raw --disable-default-bootnode > rococo_local.json
```
Για να χρησιμοποιήσετε το νέο chain spec αντικαταστήστε το αρχείο rococo.json στον φάκελο ./config/ με αυτό το νέο και εκτελέστε ξανά την αλυσίδα.
```bash
./scripts/init.sh run
```
Μπορείτε να επεξεργαστείτε ελεύθερα τον κώδικα. Η παραπάνω εντολή θα ξαναχτίσει το έργο και θα ενημερώσει τον κόμβο συλλέκτη πριν ξεκινήσει.
Το Cumulus είναι λογισμικό προεκδόσεων που εξακολουθεί να βρίσκεται υπό έντονη ανάπτυξη.
Χρησιμοποιούμε ένα συγκεκριμένο commit του polkadot [46c826f595021475fa5dbcd0987ed53f104e6e15  18 mar 2021](https://github.com/paritytech/polkadot/tree/46c826f595021475fa5dbcd0987ed53f104e6e15)

Μπορείτε να χρησιμοποιήσετε πιο πρόσφατες εκδόσεις του λογισμικού. Για να το κάνετε αυτό, αλλάξτε το POLKADOT_COMMIT στο αρχείο ./scipt/config.sh
στο πιο πρόσφατο commit του κλάδου `rococo-v1`, διαγράψτε το ./bin/polkadot και εκτελέστε 
```bash
./scripts/init.sh run
```

Ενημέρωση των εξαρτήσεων του έργου συλλέκτη 
```bash
cargo update
./scripts/init.sh build
```
Ορισμένες εξαρτήσεις πιθανόν να απαιτούν νέα χαρακτηριστικά του εργαλείου rust. Αυτό το έργο βασίζεται στο rust `nightly-2021-01-26`
Ενημέρωση της έκδοσης του εργαλείου rust στο αρχείο ./scripts/config.sh πριν την κατασκευή.

## Χάκεψε το parachain
[Προσθήκη εξωτερικής παλέτας](https://substrate.dev/docs/en/tutorials/add-a-pallet/) - πρέπει να είναι πιθανόν στο "μάθετε περισσότερα";
## Learn More

Ανατρέξτε στο ανώτερο [Substrate Developer Hub Node Template](https://github.com/substrate-developer-hub/substrate-node-template) για να μάθετε περισσότερα για τη δομή αυτού του έργου, τις δυνατότητες που ενσωματώνει και τον τρόπο με τον οποίο υλοποιούνται αυτές οι δυνατότητες. Μπορείτε να μάθετε περισσότερα για [Το Μονοπάτι του Μπλοκ Parachain](https://polkadot.network/the-path-of-a-parachain-block/) στο επίσημο ιστολόγιο του Polkadot. [Parity Cumulus Workshop](https://substrate.dev/cumulus-workshop/#/)
